<section class="space-y-8 animate-in fade-in duration-500">

  <!-- ENTERPRISE BDE COMMAND CENTER -->
  <div class="relative overflow-hidden bg-gradient-to-r from-blue-900 via-indigo-900 to-violet-900 rounded-3xl p-8 shadow-2xl border border-blue-500/20">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"40\" height=\"40\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cdefs%3E%3Cpattern id=\"grid\" width=\"40\" height=\"40\" patternUnits=\"userSpaceOnUse\"%3E%3Cpath d=\"M 40 0 L 0 0 0 40\" fill=\"none\" stroke=\"rgba(255,255,255,0.03)\" stroke-width=\"1\"/%3E%3C/pattern%3E%3C/defs%3E%3Crect width=\"100%25\" height=\"100%25\" fill=\"url(%23grid)\"/%3E%3C/svg%3E')]"></div>
    
    <div class="relative flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
      <div>
        <div class="flex items-center gap-3 mb-3">
          <div class="w-3 h-3 rounded-full bg-emerald-400 animate-pulse"></div>
          <p class="text-emerald-400 text-xs font-bold uppercase tracking-[0.2em]">BDE Portal</p>
        </div>
        <h1 class="text-4xl md:text-5xl font-black text-white mb-3 tracking-tight">
          Welcome, <%= typeof profile !== 'undefined' && profile.full_name ? profile.full_name.split(' ')[0] : 'BDE' %>! 
        </h1>
        <p class="text-blue-200 text-sm max-w-md">Client relationships • Quotation management • Revenue tracking</p>
      </div>
      
      <div class="flex items-center gap-4">
        <!-- Quick Stats Pill -->
        <div class="hidden lg:flex items-center gap-3 bg-white/5 backdrop-blur-sm rounded-xl px-4 py-3 border border-white/10">
          <div class="text-center px-3 border-r border-white/10">
            <p class="text-2xl font-black text-white"><%= kpis.confirmedOrders %></p>
            <p class="text-[10px] text-blue-300 uppercase tracking-wider">Confirmed</p>
          </div>
          <div class="text-center px-3">
            <p class="text-2xl font-black text-emerald-400">$<%= kpis.totalRevenue.toFixed(0) %></p>
            <p class="text-[10px] text-blue-300 uppercase tracking-wider">Revenue</p>
          </div>
        </div>
        
        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
          <i class="fi fi-rr-user-headset text-white text-2xl"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- PREMIUM KPI CARDS -->
  <div class="grid grid-cols-2 lg:grid-cols-3 gap-6">

    <!-- KPI 1: New Queries -->
    <a href="/bde/queries?status=new" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-amber-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-amber-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-500/30">
            <i class="fi fi-rr-envelope-open-text text-white text-2xl"></i>
          </div>
          <span class="text-xs font-bold text-amber-600 bg-amber-50 px-3 py-1 rounded-full uppercase tracking-wider">Today</span>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">New Queries</p>
        <p class="text-4xl font-black text-slate-800"><%= kpis.newQueries %></p>
        <div class="mt-3 flex items-center text-xs text-amber-600 font-bold">
          <i class="fi fi-rr-arrow-right mr-1"></i> View & Process →
        </div>
      </div>
    </a>

    <!-- KPI 2: Pending Quotations -->
    <a href="/bde/queries?status=quotation_sent" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-purple-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-violet-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center shadow-lg shadow-purple-500/30">
            <i class="fi fi-rr-file-invoice-dollar text-white text-2xl"></i>
          </div>
          <% if (kpis.pendingQuotations > 0) { %>
            <span class="text-xs font-bold text-purple-600 bg-purple-50 px-3 py-1 rounded-full animate-pulse">Awaiting</span>
          <% } %>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">Pending Quotations</p>
        <p class="text-4xl font-black text-slate-800"><%= kpis.pendingQuotations %></p>
        <div class="mt-3 flex items-center text-xs text-purple-600 font-bold">
          <i class="fi fi-rr-clock mr-1"></i> Client Response →
        </div>
      </div>
    </a>

    <!-- KPI 3: Confirmed Orders -->
    <a href="/bde/orders" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-emerald-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-teal-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/30">
            <i class="fi fi-rr-badge-check text-white text-2xl"></i>
          </div>
          <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full uppercase">MTD</span>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">Confirmed Orders</p>
        <p class="text-4xl font-black text-slate-800"><%= kpis.confirmedOrders %></p>
        <div class="mt-3 flex items-center text-xs text-emerald-600 font-bold">
          <i class="fi fi-rr-chart-line-up mr-1"></i> This Month →
        </div>
      </div>
    </a>

    <!-- KPI 4: Revenue -->
    <a href="/bde/orders" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-blue-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/30">
            <i class="fi fi-rr-chart-pie-alt text-white text-2xl"></i>
          </div>
          <span class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full uppercase">Revenue</span>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">Total Revenue</p>
        <p class="text-4xl font-black text-emerald-600">$<%= kpis.totalRevenue.toFixed(2) %></p>
        <div class="mt-3 flex items-center text-xs text-blue-600 font-bold">
          <i class="fi fi-rr-coins mr-1"></i> Monthly Total →
        </div>
      </div>
    </a>

    <!-- KPI 5: Pending Payments -->
    <a href="/bde/payments" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-rose-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-rose-500/5 to-red-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-rose-500 to-red-600 flex items-center justify-center shadow-lg shadow-rose-500/30 <%= kpis.pendingPayments > 0 ? 'animate-pulse' : '' %>">
            <i class="fi fi-rr-credit-card text-white text-2xl"></i>
          </div>
          <% if (kpis.pendingPayments > 0) { %>
            <span class="text-xs font-bold text-rose-600 bg-rose-50 px-3 py-1 rounded-full animate-pulse">Action</span>
          <% } %>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">Pending Payments</p>
        <p class="text-4xl font-black <%= kpis.pendingPayments > 0 ? 'text-rose-600' : 'text-slate-800' %>"><%= kpis.pendingPayments %></p>
        <div class="mt-3 flex items-center text-xs text-rose-600 font-bold">
          <i class="fi fi-rr-bell mr-1"></i> Send Reminder →
        </div>
      </div>
    </a>

    <!-- KPI 6: Drafts Awaiting -->
    <a href="/bde/orders" class="group relative bg-white rounded-2xl p-6 border border-slate-200/60 shadow-sm hover:shadow-xl hover:border-indigo-300 transition-all duration-300 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-violet-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative">
        <div class="flex items-center justify-between mb-4">
          <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
            <i class="fi fi-rr-document-signed text-white text-2xl"></i>
          </div>
          <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full uppercase">QC</span>
        </div>
        <p class="text-sm text-slate-500 font-semibold mb-1">Drafts Awaiting</p>
        <p class="text-4xl font-black text-slate-800"><%= kpis.draftsAwaitingApproval %></p>
        <div class="mt-3 flex items-center text-xs text-indigo-600 font-bold">
          <i class="fi fi-rr-eye mr-1"></i> Admin Approval →
        </div>
      </div>
    </a>

  </div>

  <!-- MAIN CONTENT GRID -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- QUICK ACTIONS -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
      <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
        <h3 class="text-lg font-black text-white flex items-center gap-2">
          <i class="fi fi-rr-bolt"></i> Quick Actions
        </h3>
      </div>
      <div class="p-4 space-y-2">
        <a href="/bde/clients" class="flex items-center gap-3 p-4 rounded-xl bg-slate-50 hover:bg-blue-50 border border-transparent hover:border-blue-200 transition-all group">
          <div class="w-12 h-12 rounded-xl bg-blue-100 group-hover:bg-blue-200 flex items-center justify-center transition-colors">
            <i class="fi fi-rr-users text-blue-600 text-xl"></i>
          </div>
          <div class="flex-1">
            <p class="font-bold text-slate-800">Manage Clients</p>
            <p class="text-xs text-slate-500">View assigned clients</p>
          </div>
          <i class="fi fi-rr-angle-right text-slate-400 group-hover:text-blue-600 transition-colors"></i>
        </a>
        
        <a href="/bde/queries" class="flex items-center gap-3 p-4 rounded-xl bg-slate-50 hover:bg-amber-50 border border-transparent hover:border-amber-200 transition-all group">
          <div class="w-12 h-12 rounded-xl bg-amber-100 group-hover:bg-amber-200 flex items-center justify-center transition-colors">
            <i class="fi fi-rr-file-add text-amber-600 text-xl"></i>
          </div>
          <div class="flex-1">
            <p class="font-bold text-slate-800">Process Queries</p>
            <p class="text-xs text-slate-500">Create quotations</p>
          </div>
          <i class="fi fi-rr-angle-right text-slate-400 group-hover:text-amber-600 transition-colors"></i>
        </a>
        
        <a href="/bde/payments" class="flex items-center gap-3 p-4 rounded-xl bg-slate-50 hover:bg-emerald-50 border border-transparent hover:border-emerald-200 transition-all group">
          <div class="w-12 h-12 rounded-xl bg-emerald-100 group-hover:bg-emerald-200 flex items-center justify-center transition-colors">
            <i class="fi fi-rr-credit-card text-emerald-600 text-xl"></i>
          </div>
          <div class="flex-1">
            <p class="font-bold text-slate-800">Payment Tracking</p>
            <p class="text-xs text-slate-500">Monitor & remind clients</p>
          </div>
          <i class="fi fi-rr-angle-right text-slate-400 group-hover:text-emerald-600 transition-colors"></i>
        </a>
      </div>
    </div>

    <!-- WORKFLOW FUNNEL -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
      <div class="bg-gradient-to-r from-violet-600 to-purple-600 px-6 py-4">
        <h3 class="text-lg font-black text-white flex items-center gap-2">
          <i class="fi fi-rr-funnel"></i> Sales Funnel
        </h3>
      </div>
      <div class="p-4 space-y-3">
        <div class="flex items-center gap-3 p-3 rounded-xl bg-amber-50 border border-amber-200">
          <div class="w-10 h-10 rounded-lg bg-amber-500 text-white flex items-center justify-center text-sm font-bold">1</div>
          <div class="flex-1">
            <p class="text-sm font-bold text-slate-800">New Leads</p>
            <p class="text-xs text-slate-500">Fresh queries</p>
          </div>
          <span class="text-xl font-black text-amber-600"><%= kpis.newQueries %></span>
        </div>
        
        <div class="flex items-center gap-3 p-3 rounded-xl bg-purple-50 border border-purple-200">
          <div class="w-10 h-10 rounded-lg bg-purple-500 text-white flex items-center justify-center text-sm font-bold">2</div>
          <div class="flex-1">
            <p class="text-sm font-bold text-slate-800">Quoted</p>
            <p class="text-xs text-slate-500">Awaiting response</p>
          </div>
          <span class="text-xl font-black text-purple-600"><%= kpis.pendingQuotations %></span>
        </div>
        
        <div class="flex items-center gap-3 p-3 rounded-xl bg-blue-50 border border-blue-200">
          <div class="w-10 h-10 rounded-lg bg-blue-500 text-white flex items-center justify-center text-sm font-bold">3</div>
          <div class="flex-1">
            <p class="text-sm font-bold text-slate-800">Payment Due</p>
            <p class="text-xs text-slate-500">Accepted, unpaid</p>
          </div>
          <span class="text-xl font-black text-blue-600"><%= kpis.pendingPayments %></span>
        </div>
        
        <div class="flex items-center gap-3 p-3 rounded-xl bg-emerald-50 border border-emerald-200">
          <div class="w-10 h-10 rounded-lg bg-emerald-500 text-white flex items-center justify-center text-sm font-bold">4</div>
          <div class="flex-1">
            <p class="text-sm font-bold text-slate-800">Converted</p>
            <p class="text-xs text-slate-500">This month</p>
          </div>
          <span class="text-xl font-black text-emerald-600"><%= kpis.confirmedOrders %></span>
        </div>
      </div>
    </div>

    <!-- PERFORMANCE METRICS -->
    <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
      <div class="bg-gradient-to-r from-slate-700 to-slate-800 px-6 py-4">
        <h3 class="text-lg font-black text-white flex items-center gap-2">
          <i class="fi fi-rr-chart-histogram"></i> Performance
        </h3>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <div class="flex items-center justify-between mb-2">
            <p class="text-sm font-semibold text-slate-600">Conversion Rate</p>
            <span class="text-sm font-black text-emerald-600"><%= kpis.pendingQuotations > 0 ? ((kpis.confirmedOrders / (kpis.pendingQuotations + kpis.confirmedOrders) * 100).toFixed(0)) : 0 %>%</span>
          </div>
          <div class="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
            <div class="bg-gradient-to-r from-emerald-500 to-teal-500 h-3 rounded-full transition-all duration-1000" style="width: <%= kpis.pendingQuotations > 0 ? (kpis.confirmedOrders / (kpis.pendingQuotations + kpis.confirmedOrders) * 100) : 0 %>%"></div>
          </div>
        </div>
        
        <div>
          <div class="flex items-center justify-between mb-2">
            <p class="text-sm font-semibold text-slate-600">Payment Collection</p>
            <span class="text-sm font-black text-blue-600"><%= kpis.confirmedOrders > 0 ? (100 - (kpis.pendingPayments / kpis.confirmedOrders * 100)).toFixed(0) : 100 %>%</span>
          </div>
          <div class="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-indigo-500 h-3 rounded-full transition-all duration-1000" style="width: <%= kpis.confirmedOrders > 0 ? (100 - (kpis.pendingPayments / kpis.confirmedOrders * 100)) : 100 %>%"></div>
          </div>
        </div>
        
        <div>
          <div class="flex items-center justify-between mb-2">
            <p class="text-sm font-semibold text-slate-600">Order Progress</p>
            <span class="text-sm font-black text-violet-600"><%= (100 - (kpis.draftsAwaitingApproval / (kpis.confirmedOrders || 1) * 100)).toFixed(0) %>%</span>
          </div>
          <div class="w-full bg-slate-100 rounded-full h-3 overflow-hidden">
            <div class="bg-gradient-to-r from-violet-500 to-purple-500 h-3 rounded-full transition-all duration-1000" style="width: <%= (100 - (kpis.draftsAwaitingApproval / (kpis.confirmedOrders || 1) * 100)).toFixed(0) %>%"></div>
          </div>
        </div>
        
        <!-- Revenue Target -->
        <div class="mt-6 p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl border border-slate-200">
          <div class="flex items-center justify-between mb-3">
            <p class="text-sm font-bold text-slate-700">Monthly Revenue</p>
            <i class="fi fi-rr-coin text-slate-400"></i>
          </div>
          <p class="text-3xl font-black text-emerald-600 mb-1">$<%= kpis.totalRevenue.toFixed(2) %></p>
          <p class="text-xs text-slate-500">Target: $10,000</p>
          <div class="w-full bg-slate-200 rounded-full h-2 mt-2 overflow-hidden">
            <div class="bg-gradient-to-r from-emerald-500 to-teal-500 h-2 rounded-full" style="width: <%= Math.min((kpis.totalRevenue / 10000) * 100, 100) %>%"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

</section>

<script>
function applyFilter() {
  const filter = document.getElementById('dateFilter').value;
  window.location.href = `/bde/?dateFilter=${filter}`;
}
</script>
