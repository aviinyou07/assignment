<div id="sidebar-overlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-slate-900/60 z-40 hidden lg:hidden backdrop-blur-sm"></div>

<!-- PREMIUM WRITER SIDEBAR -->
<aside id="main-sidebar" class="fixed top-0 left-0 h-full w-72 bg-gradient-to-b from-emerald-900 via-teal-900 to-cyan-900 text-teal-100 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col shadow-2xl">
    
    <!-- LOGO SECTION -->
    <div class="p-6 border-b border-emerald-700/30">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/30">
                <span class="text-white font-black text-lg">A</span>
            </div>
            <div>
                <h1 class="text-xl font-black text-white tracking-tight">Assignment<span class="text-emerald-400">366</span></h1>
                <p class="text-[10px] text-emerald-300 uppercase tracking-widest font-semibold">Writer Portal</p>
            </div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="flex-1 px-4 py-4 space-y-1 overflow-y-auto custom-scrollbar">
        
        <!-- Dashboard -->
        <a href="/writer" id="nav-overview" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
            <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                <i class="fi fi-rr-chart-histogram text-sm"></i>
            </div>
            Dashboard
        </a>

        <!-- WORKFLOW SECTION -->
        <div class="pt-4 pb-2">
            <p class="text-[10px] font-black text-emerald-400 uppercase tracking-[0.2em] px-4 mb-3">Workflow</p>
            
            <a href="/writer/queries" id="nav-queries" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-time-fast text-sm"></i>
                </div>
                <span class="flex-1">New Enquiries</span>
                <span class="bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded-full text-[10px] font-bold" id="sidebar-new-count">0</span>
            </a>

            <a href="/writer/active-tasks" id="nav-active-tasks" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-edit text-sm"></i>
                </div>
                <span class="flex-1">Active Tasks</span>
                <span class="bg-indigo-500/20 text-indigo-400 px-2 py-0.5 rounded-full text-[10px] font-bold" id="sidebar-active-count">0</span>
            </a>

            <a href="/writer/updates" id="nav-updates" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-refresh text-sm"></i>
                </div>
                <span class="flex-1">Project Updates</span>
            </a>

            <a href="/writer/delivery" id="nav-delivery" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-paper-plane text-sm"></i>
                </div>
                <span class="flex-1">Submissions</span>
            </a>

            <a href="/writer/chat" id="nav-chat" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-comments text-sm"></i>
                </div>
                <span class="flex-1">Chat Hub</span>
            </a>
        </div>

        <!-- ACCOUNT SECTION -->
        <div class="pt-4 pb-2">
            <p class="text-[10px] font-black text-emerald-400 uppercase tracking-[0.2em] px-4 mb-3">Account</p>
            
            <a href="/writer/profile" id="nav-profile" class="nav-btn px-4 py-3 rounded-xl font-semibold text-sm transition-all flex items-center gap-3 group">
                <div class="nav-icon w-8 h-8 rounded-lg flex items-center justify-center transition-colors">
                    <i class="fi fi-rr-user text-sm"></i>
                </div>
                My Profile
            </a>
        </div>

    </nav>
</aside>

<script>
    function toggleMobileMenu() {
        const sidebar = document.getElementById('main-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        sidebar.classList.toggle('-translate-x-full');
        overlay.classList.toggle('hidden');
    }

    // Highlight active nav button based on current URL
    function updateActiveNav() {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
            btn.querySelector('.nav-icon')?.classList.remove('bg-white/20');
            btn.querySelector('.nav-icon')?.classList.add('bg-emerald-800/50');
        });
        
        const path = window.location.pathname;
        let activeId = 'nav-overview';
        
        if (path === '/writer' || path === '/writer/') {
            activeId = 'nav-overview';
        } else if (path.includes('/queries')) {
            activeId = 'nav-queries';
        } else if (path.includes('/active-tasks')) {
            activeId = 'nav-active-tasks';
        } else if (path.includes('/updates')) {
            activeId = 'nav-updates';
        } else if (path.includes('/delivery')) {
            activeId = 'nav-delivery';
        } else if (path.includes('/chat')) {
            activeId = 'nav-chat';
        } else if (path.includes('/profile')) {
            activeId = 'nav-profile';
        }
        
        const activeElement = document.getElementById(activeId);
        if (activeElement) {
            activeElement.classList.add('active');
            activeElement.querySelector('.nav-icon')?.classList.remove('bg-emerald-800/50');
            activeElement.querySelector('.nav-icon')?.classList.add('bg-white/20');
        }
    }
    
    document.addEventListener('DOMContentLoaded', updateActiveNav);
    window.addEventListener('load', updateActiveNav);
    window.addEventListener('popstate', updateActiveNav);
    
    // Update sidebar counts
    async function updateWriterSidebarCounts() {
        try {
            const response = await fetch('/writer/dashboard/kpis');
            if (response.ok) {
                const data = await response.json();
                if (data.success && data.kpis) {
                    document.getElementById('sidebar-new-count').textContent = data.kpis.newTasks || 0;
                    document.getElementById('sidebar-active-count').textContent = data.kpis.activeTasks || 0;
                }
            }
        } catch (err) {
            console.log('Writer sidebar counts fetch failed:', err.message);
        }
    }
    
    updateWriterSidebarCounts();
    setInterval(updateWriterSidebarCounts, 30000);
</script>

<style>
    .nav-btn { 
        color: #99f6e4; 
        transition: all 0.2s ease; 
    }
    .nav-btn:hover { 
        background-color: rgba(255, 255, 255, 0.05); 
        color: #fff; 
    }
    .nav-btn.active { 
        background: linear-gradient(to right, #10b981, #14b8a6);
        color: #fff; 
        box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3); 
    }
    .nav-icon {
        background-color: rgba(6, 78, 59, 0.5);
    }
    .nav-btn:hover .nav-icon {
        background-color: rgba(6, 78, 59, 0.7);
    }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(16, 185, 129, 0.3); border-radius: 10px; }
</style>
